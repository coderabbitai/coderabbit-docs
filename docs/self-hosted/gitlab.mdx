---
title: Use Self-Hosted CodeRabbit With GitLab
sidebar_label: GitLab
description: Instructions to self-host CodeRabbit and integrate it with GitLab.
sidebar_position: 2
---

import ListItems from '@site/src/components/ListItems/ListItems';
import Note from '@site/src/components/Note/Note';
import DarkCodeBlock from '@site/src/components/DarkCodeBlock/DarkCodeBlock';

<Note>

The self-hosted option is only available for CodeRabbit Enterprise customers with 500 user seats or more. Please contact [CodeRabbit Sales](mailto:sales@coderabbit.ai) to learn more about the CodeRabbit Enterprise plan.

</Note>

## Create a GitLab User

<ListItems items={[
  <><strong>Username</strong>: Set the username to "CodeRabbit" for easier identification (optional).</>,
  <><strong>Profile Image</strong>: Use the CodeRabbitAI logo for the user image (optional).</>
]} />

We recommend using the CodeRabbit [logo](/img/integrations/logo.png) as the profile picture to ensures easy recognition.

## Add User to Projects

Add the CodeRabbit user to each project where you want CodeRabbit to post reviews, with at least `Developer` access.

## Create a Personal Access Token for CodeRabbit user

Generate a personal access token for the CodeRabbit user to be added in the `.env` file as `GITLAB_BOT_TOKEN`.

**Necessary Scopes**:

- `api`

Consult official CodeRabbitAI documentation for a detailed [guide](https://docs.coderabbit.ai/integrations/self-hosted-gitlab#generating-personal-access-token) on creating personal access tokens.

## Add a webhook to each project

<ListItems orderedList items={[
  <><strong>Navigate to Add Webhook Page</strong>: Go to the webhook configuration page in the desired GitLab project.</>,
  <><strong>Add Webhook URL</strong>: Enter the URL pointing to the CodeRabbit service, followed by <code>/gitlab_webhooks</code> (e.g., <code>http://127.0.0.1:8080/gitlab_webhooks</code>).</>,
  <><strong>Generate and Save Secret Token</strong>: Generate a secret token, add it to the webhook, and store it securely. This will be needed for the <code>.env</code> file as <code>GITLAB_WEBHOOK_SECRET</code> (you can use a single secret token for all projects).</>,
  <><strong>Select triggers</strong>:
    <ListItems nested items={[
      <>Push events</>,
      <>Comments</>,
      <>Issues events</>,
      <>Merge request events</>
    ]} />
  </>
]} />

## Add Webhook Using a Script

We have a convenient [script](/code/gitlab-webhook.sh) to help you add webhooks to a project or all projects under a group in a GitLab instance.

<DarkCodeBlock language="bash">
{`# Make sure the script is executable:
chmod +x gitlab-webhook.sh`}
</DarkCodeBlock>

Example usage:

<DarkCodeBlock language="bash">
{`# PAT example (header auto-detected)
export GITLAB_TOKEN="glpat-xxxxx"
./gitlab-add-webhook.sh \\
  -h "gitlab.example.com" -u "http://<coderabbit-agent-addr>/gitlab_webhooks" \\
  -s "mySecret" -p 42

# PAT example (explicit header)
./gitlab-add-webhook.sh \\
  -h "gitlab.example.com" -u "http://<coderabbit-agent-addr>/gitlab_webhooks" \\
  -s "mySecret" -g "mygroup/mysubgroup/myproject" \\
  -t "glpat-xxxxx" \\
  -A "PRIVATE-TOKEN"

# OAuth token with explicit header
./gitlab-add-webhook.sh \\
  -h "gitlab.example.com" -u "http://<coderabbit-agent-addr>/gitlab_webhooks" \\
  -s "mySecret" -g "company/backend" \\
  -t "eyJhbGciOi..." \\
  -A "Authorization: Bearer"`}
</DarkCodeBlock>

## Prepare a `.env` file

Create a `.env` file with the following content:

<DarkCodeBlock language="bash">
{`# if using OpenAI
LLM_PROVIDER=openai
LLM_TIMEOUT=360000
OPENAI_API_KEYS=<openai-key>
OPENAI_BASE_URL=[<openai-base-url>]
OPENAI_ORG_ID=[<openai-org-id>]
OPENAI_PROJECT_ID=[<openai-project-id>]

# if using Azure OpenAI
LLM_PROVIDER=azure-openai
LLM_TIMEOUT=360000
AZURE_OPENAI_ENDPOINT=<azure-openai-endpoint>
AZURE_OPENAI_API_KEY=<key>
# it is recommended to deploy text-embedding-3-large, gpt-4.1-mini, o4-mini, o3, gpt-4.1 (optionally).
AZURE_TEXT_EMBEDDING_3_LARGE_DEPLOYMENT_NAME=<text-embedding-3-large-deployment-name>
AZURE_GPT41MINI_DEPLOYMENT_NAME=<gpt-4.1-mini-deployment-name>
AZURE_O4MINI_DEPLOYMENT_NAME=<o4-mini-deployment-name>
AZURE_O3_DEPLOYMENT_NAME=<o3-deployment-name>
AZURE_GPT41_DEPLOYMENT_NAME=[<gpt-4.1-deployment-name>]
# optionally, deploy gpt-4o-mini instead of gpt-4.1-mini
AZURE_GPT4OMINI_DEPLOYMENT_NAME=[<gpt-4o-mini-deployment-name>]
# optionally, deploy o3-mini instead of o4-mini
AZURE_O3MINI_DEPLOYMENT_NAME=[<o3-mini-deployment-name>]
# optionally, deploy o1 instead of o3
AZURE_O1_DEPLOYMENT_NAME=[<o1-deployment-name>]

# OAuth2 Configuration (optional)
# This will use client_credentials flow to get an access token,
# and use it to make requests to the LLM provider.
# Here is more information on this flow: https://learn.microsoft.com/en-us/entra/identity-platform/v2-oauth2-client-creds-grant-flow#first-case-access-token-request-with-a-shared-secret
# It is expected that the response from the OAuth2 server will be in the format
# {
#   "access_token": "<access-token>",
#   "token_type": "Bearer",
#   "expires_in": 3599,
# }
OAUTH2_ENDPOINT=[<endpoint>]
OAUTH2_CLIENT_ID=[<client-id>]
OAUTH2_CLIENT_SECRET=[<client-secret>]
OAUTH2_SCOPE=[<oauth2-scope>]

HTTP_PROXY=[<http-proxy-url>]
HTTPS_PROXY=[<https-proxy-url>]
NO_PROXY=[<no-proxy-url>]

# if using AWS Bedrock
# it is required to have access to claude-3-haiku, claude-3-5-haiku, claude-sonnet-4, claude-opus-4.
LLM_PROVIDER=bedrock-anthropic
LLM_TIMEOUT=360000
AWS_ACCESS_KEY_ID=<aws-access-key>
AWS_SECRET_ACCESS_KEY=<aws-secret-access-key>
AWS_REGION=<aws-region>

# if using Anthropic
LLM_PROVIDER=anthropic
LLM_TIMEOUT=360000
ANTHROPIC_API_KEYS=<anthropic-key>
ANTHROPIC_BASE_URL=[<anthropic-base-url>]

TEMP_PATH=/cache

SELF_HOSTED=gitlab

GITLAB_BOT_TOKEN=<personal-access-token>
GITLAB_WEBHOOK_SECRET=<webhook-secret-key>
# if seeing '500 Internal Server Error' in CodeRabbit logs when trying to post review comments,
# make sure to set the following environment variable to 1500 (1.5 seconds).
GITLAB_PUBLISH_DELAY=[<delay-ms-between-draft-and-publish>]

CODERABBIT_LICENSE_KEY=<license-key>

CODERABBIT_API_KEY=<coderabbitai-api-key>
ENABLE_METRICS=[true]
ENABLE_LEARNINGS=[true]
# if using CodeRabbit's learnings, also provide the following
# for example, s3://bucket/path/to/database, gs://bucket/path/to/database, etc.
OBJECT_STORE_URI=[<object-store-uri>]

JIRA_HOST=[<jira-host-url>]
JIRA_PAT=[<jira-personal-access-token>]

LINEAR_PAT=[<linear-personal-access-token>]

ENABLE_WEB_SEARCH=[true]
PERPLEXITY_API_KEY=[<perplexity-api-key>]

YAML_CONFIG=[<escaped-yaml-config>]`}
</DarkCodeBlock>

<Note>

<ListItems items={[
  <>If you are using Azure OpenAI, verify that the model deployment names are in the .env file.</>,
  <>Values marked with [] are not optional to provide.</>,
  <>You can generate <code>CODERABBIT_API_KEY</code> from CodeRabbit UI {"->"} Organizations Settings {"->"} API Keys.</>,
  <><code>YAML_CONFIG</code> is an optional configuration file that can be used to customize CodeRabbit's behavior at the deployment level. It takes the same format as the <a href="/docs/getting-started/configure-coderabbit.md">CodeRabbit YAML configuration</a> file. It requires the entire YAML file to be in an escaped string format, for example, <code>YAML_CONFIG="key1: value1\nkey2: value2"</code>. You can use <a href="https://escapeyaml.dev/">Escape YAML</a> to generate the escaped string.</>
]} />

</Note>

## Pull the CodeRabbit Docker image

Authenticate and pull the Docker image using the provided credentials file:

<DarkCodeBlock language="bash">
{`cat coderabbit.json | docker login -u _json_key --password-stdin us-docker.pkg.dev
docker pull <docker-registry>/coderabbit-agent:latest`}
</DarkCodeBlock>

### Verify the image is up

You can query `/health` endpoint to verify that the coderabbit-agent service is up and running.

<DarkCodeBlock language="bash">
{`curl 127.0.0.1:8080/health`}
</DarkCodeBlock>

## Host the image

You can host the image on a server, serverless function, or container environment and expose port `8080`. Run the Docker image with the equivalent command on your chosen platform, ensuring you replace the `.env` file path with the path to your actual `.env` file:

<DarkCodeBlock language="bash">
{`docker run --env-file .env --publish 127.0.0.1:8080:8080 <docker-registry>/coderabbit-agent:latest`}
</DarkCodeBlock>
